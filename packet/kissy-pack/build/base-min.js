/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 23 12:19
*/
KISSY.add("base/attribute",function(i,h){function s(a,b){if(i.isString(b))return a[b];return b}function n(a,b,c,d,f,e,j){j=j||c;return a.fire(b+(c.charAt(0).toUpperCase()+c.substring(1))+"Change",{attrName:j,subAttrName:e,prevVal:d,newVal:f})}function k(a,b,c){var d=a[b]||{};if(c)a[b]=d;return d}function g(a){return k(a,"__attrs",true)}function m(a){return k(a,"__attrVals",true)}function o(a,b){for(var c=0,d=b.length;a!=h&&c<d;c++)a=a[b[c]];return a}function t(a,b,c,d,f){d=d||{};var e,j,l,p=b;if(b.indexOf(".")!==
-1){e=b.split(".");b=e.shift()}l=a.get(b);if(e)j=o(l,e);if(!e&&l===c)return h;else if(e&&j===c)return h;if(e){var q=j=i.clone(l),r=e.length-1;if(r>=0){for(var v=0;v<r;v++)q=q[e[v]];if(q!=h)q[e[v]]=c}c=j}if(!d.silent)if(false===n(a,"before",b,l,c,p))return false;c=a.__set(b,c,d);if(c===false)return c;if(!d.silent){c=m(a)[b];n(a,"after",b,l,c,p);f?f.push({prevVal:l,newVal:c,attrName:b,subAttrName:p}):n(a,"","*",[l],[c],[p],[b])}return a}function u(){}function w(a,b,c,d){var f=k(g(a),b,true).validator;
if(f&&(f=s(a,f))){a=f.call(a,c,b,d);if(a!==h&&a!==true)return a}return h}u.INVALID={};var x=u.INVALID;i.augment(u,{getAttrs:function(){return g(this)},getAttrVals:function(){var a={},b,c=g(this);for(b in c)a[b]=this.get(b);return a},addAttr:function(a,b,c){var d=g(this);b=i.clone(b);if(d[a])i.mix(d[a],b,c);else d[a]=b;return this},addAttrs:function(a,b){var c=this;i.each(a,function(d,f){c.addAttr(f,d)});b&&c.set(b);return c},hasAttr:function(a){return a&&g(this).hasOwnProperty(a)},removeAttr:function(a){if(this.hasAttr(a)){delete g(this)[a];
delete m(this)[a]}return this},set:function(a,b,c){if(i.isPlainObject(a)){c=b;b=Object(a);var d=[],f,e=[];for(a in b)if((f=w(this,a,b[a],b))!==h)e.push(f);if(e.length){c.error&&c.error(e);return false}for(a in b)t(this,a,b[a],c,d);var j=[],l=[],p=[],q=[];i.each(d,function(r){l.push(r.prevVal);p.push(r.newVal);j.push(r.attrName);q.push(r.subAttrName)});j.length&&n(this,"","*",l,p,q,j);return this}return t(this,a,b,c)},__set:function(a,b,c){var d,f,e=k(g(this),a,true).setter;f=w(this,a,b);if(f!==h){c.error&&
c.error(f);return false}if(e&&(e=s(this,e)))d=e.call(this,b,a);if(d===x)return false;if(d!==h)b=d;m(this)[a]=b},get:function(a){var b,c=m(this),d;if(a.indexOf(".")!==-1){b=a.split(".");a=b.shift()}d=k(g(this),a).getter;c=a in c?c[a]:this.__getDefAttrVal(a);if(d&&(d=s(this,d)))c=d.call(this,c,a);if(b)c=o(c,b);return c},__getDefAttrVal:function(a){var b=g(this),c=k(b,a),d=c.valueFn;if(d&&(d=s(this,d))){d=d.call(this);if(d!==h)c.value=d;delete c.valueFn;b[a]=c}return c.value},reset:function(a,b){if(i.isString(a))return this.hasAttr(a)?
this.set(a,this.__getDefAttrVal(a),b):this;b=a;var c=g(this),d={};for(a in c)d[a]=this.__getDefAttrVal(a);this.set(d,b);return this}});if(h)u.prototype.addAttrs=h;return u});
KISSY.add("base",function(i,h,s){function n(k){for(var g=this.constructor;g;){var m=g.ATTRS;if(m){var o=void 0;for(o in m)m.hasOwnProperty(o)&&this.addAttr(o,m[o],false)}g=g.superclass?g.superclass.constructor:null}if(k)for(var t in k)k.hasOwnProperty(t)&&this.__set(t,k[t])}i.augment(n,s.Target,h);n.Attribute=h;return i.Base=n},{requires:["base/attribute","event"]});
