/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 23 12:19
*/
KISSY.add("overlay/aria",function(c,e){function h(){}h.ATTRS={aria:{view:true}};h.prototype={__bindUI:function(){var f=this,g=f.get("el");f.get("aria")&&g.on("keydown",function(a){if(a.keyCode===e.KeyCodes.ESC){f.hide();a.halt()}})}};return h},{requires:["event"]});
KISSY.add("overlay/ariarender",function(c,e){function h(){}function f(b){var d=b.keyCode,i=this.get("el");if(d==a){d=g(b.target);var j=this.__ariaArchor;if(d.equals(i)&&b.shiftKey){j[0].focus();b.halt()}else if(d.equals(j)&&!b.shiftKey){i[0].focus();b.halt()}else if(d.equals(i)||i.contains(d))return;b.halt()}}var g=e.all,a=e.KeyCodes.TAB;h.prototype={__renderUI:function(){var b=this.get("el"),d=this.get("header");if(this.get("aria")){b.attr("role","dialog");b.attr("tabindex",0);d.attr("id")||d.attr("id",
c.guid("ks-dialog-header"));b.attr("aria-labelledby",d.attr("id"));this.__ariaArchor=g("<div tabindex='0'></div>").appendTo(b)}},__bindUI:function(){var b=this;if(b.get("aria")){var d=b.get("el"),i;b.on("afterVisibleChange",function(j){if(j.newVal){i=d[0].ownerDocument.activeElement;d[0].focus();d.attr("aria-hidden","false");d.on("keydown",f,b)}else{d.attr("aria-hidden","true");d.detach("keydown",f,b);i&&i.focus()}})}}};return h},{requires:["node"]});
KISSY.add("overlay/base",function(c,e,h,f,g){function a(b){return c.require("uibase/"+b)}e=e.create(h.Controller,[a("contentbox"),a("position"),a("loading"),a("align"),a("close"),a("resize"),a("mask"),g],{},{ATTRS:{focusable:{value:false},closable:{value:false},handleMouseEvents:{value:false},allowTextSelection_:{value:true},visibleMode:{value:"visibility"}}});e.DefaultRender=f;h.UIStore.setUIByClass("overlay",{priority:h.UIStore.PRIORITY.LEVEL1,ui:e});return e},{requires:["uibase","component","./overlayrender",
"./effect"]});KISSY.add("overlay/dialog",function(c,e,h,f,g,a){c=f.create(h,[c.require("uibase/stdmod"),c.require("uibase/drag"),c.require("uibase/constrain"),a],{},{ATTRS:{closable:{value:true},handlers:{valueFn:function(){var b=this;return[function(){return b.get("view").get("header")}]}}}});c.DefaultRender=g;e.UIStore.setUIByClass("dialog",{priority:e.UIStore.PRIORITY.LEVEL2,ui:c});return c},{requires:["component","overlay/base","uibase","overlay/dialogrender","./aria"]});
KISSY.add("overlay/dialogrender",function(c,e,h,f){return e.create(h,[c.require("uibase/stdmodrender"),f])},{requires:["uibase","./overlayrender","./ariarender"]});
KISSY.add("overlay/effect",function(c){function e(){}function h(b,d){var i=b.get("el"),j=b.get("effect"),k=j.effect,m=j.duration;j=j.easing;if(k!=f){var l=d?1:0;i.stop(1,1);i.css({visibility:"visible",display:a[l]});i[k+g[k][l]](m,function(){i.css({display:a[0],visibility:d?"visible":"hidden"})},j)}}var f="none",g={fade:["Out","In"],slide:["Up","Down"]},a=["block","none"];e.ATTRS={effect:{value:{effect:f,duration:0.5,easing:"easeOut"},setter:function(b){var d=b.effect;if(c.isString(d)&&!g[d])b.effect=
f}}};e.prototype={__bindUI:function(){var b=this;b.on("hide",function(){h(b,0)});b.on("show",function(){h(b,1)})}};return e},{requires:["anim"]});KISSY.add("overlay",function(c,e,h,f,g,a){e.Render=h;f.Render=g;e.Dialog=f;c.Dialog=f;e.Popup=c.Popup=a;return e},{requires:["overlay/base","overlay/overlayrender","overlay/dialog","overlay/dialogrender","overlay/popup"]});
KISSY.add("overlay/overlayrender",function(c,e,h,f){function g(a){return c.require("uibase/"+a)}return h.create(f.Render,[g("contentboxrender"),g("positionrender"),g("loadingrender"),e.ie===6?g("shimrender"):null,g("closerender"),g("maskrender")])},{requires:["ua","uibase","component"]});
KISSY.add("overlay/popup",function(c,e,h,f){function g(a,b){if(c.isUndefined(b))b=a;else b.srcNode=a;g.superclass.constructor.call(this,b)}g.ATTRS={trigger:{setter:function(a){if(c.isString(a))a=c.all(a);return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:100},toggle:{value:false}};c.extend(g,h,{initializer:function(){var a=this;if(a.get("trigger"))if(a.get("triggerType")==="mouse"){a._bindTriggerMouse();a.on("bindUI",function(){a._bindContainerMouse()})}else a._bindTriggerClick()},
_bindTriggerMouse:function(){var a=this,b=a.get("trigger"),d;a.__mouseEnterPopup=function(i){a._clearHiddenTimer();d=c.later(function(){a._showing(i);d=f},a.get("mouseDelay"))};c.each(b,function(i){c.one(i).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=function(){if(d){d.cancel();d=f}a._setHiddenTimer()};c.each(b,function(i){c.one(i).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,
this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=c.later(function(){a._hiding()},a.get("mouseDelay"))},_clearHiddenTimer:function(){if(this._hiddenTimer){this._hiddenTimer.cancel();this._hiddenTimer=f}},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();a.get("toggle")?a[a.get("visible")?"_hiding":"_showing"](b):a._showing(b)};c.each(a.get("trigger"),function(b){c.one(b).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",c.one(a.target));
this.show()},_hiding:function(){this.set("currentTrigger",f);this.hide()},destructor:function(){var a=this,b=a.get("trigger");if(b){a.__clickPopup&&c.each(b,function(d){c.one(d).detach("click",a.__clickPopup)});a.__mouseEnterPopup&&c.each(b,function(d){c.one(d).detach("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup&&c.each(b,function(d){c.one(d).detach("mouseleave",a._mouseLeavePopup)})}a.get("el")&&a.get("el").detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,
a)}});e.UIStore.setUIByClass("popup",{priority:e.UIStore.PRIORITY.LEVEL1,ui:g});return g},{requires:["component","./base"]});
