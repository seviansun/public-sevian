/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 31 21:28
*/
KISSY.add("menu/base",function(m,k,l,n,f){function d(){this.set("highlightedItem",undefined)}var b=k.KeyCodes,g=l.create(n.Container,[l.ContentBox],{_uiSetHighlightedItem:function(e,c){var i=c&&c.prevVal;i&&i.set("highlighted",false);e&&e.set("highlighted",true);this.set("activeItem",e)},_handleBlur:function(e){g.superclass._handleBlur.call(this,e);this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(e,c){var i=this.get("children"),j=i.length,a=e;do{var h=i[e];if(!h.get("disabled")&&
h.get("visible")!==false)return i[e];e=(e+c+j)%j}while(e!=a)},_handleKeydown:function(e){if(this._handleKeyEventInternal(e)){e.halt();return true}},_handleKeyEventInternal:function(e){var c=this.get("highlightedItem");if(c&&c._handleKeydown(e))return true;var i=this.get("children"),j=i.length;if(j!==0){switch(e.keyCode){case b.ESC:return;case b.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case b.END:this.set("highlightedItem",this._getNextEnabledHighlighted(j-1,-1));
break;case b.UP:if(c){e=m.indexOf(c,i);j=(e-1+j)%j}else j=j-1;this.set("highlightedItem",this._getNextEnabledHighlighted(j,-1));break;case b.DOWN:if(c){e=m.indexOf(c,i);j=(e+1+j)%j}else j=0;this.set("highlightedItem",this._getNextEnabledHighlighted(j,1));break;default:return}return true}},bindUI:function(){this.on("hide",d,this)},containsElement:function(e){if(this.get("visible")===false||!this.get("view"))return false;if(this.get("view").containsElement(e))return true;for(var c=this.get("children"),
i=0,j=c.length;i<j;i++){var a=c[i];if(typeof a.containsElement=="function"&&a.containsElement(e))return true}return false}},{ATTRS:{focusable:{value:true},visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:true}},DefaultRender:f});n.UIStore.setUIByClass("menu",{priority:n.UIStore.PRIORITY.LEVEL1,ui:g});return g},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/filtermenu",function(m,k,l,n,f){var d=k.create(n,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},_handleMouseEnter:function(){d.superclass._handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b=this.get("view").get("filterInput"),g=this.get("highlightedItem");this.set("filterStr",b.val());if(!g||!g.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},
_uiSetFilterStr:function(b){this.filterItems(b)},filterItems:function(b){var g=this.get("view"),e=g.get("labelEl");g=g.get("filterInput");e[b?"hide":"show"]();if(this.get("allowMultiple")){e=[];var c;c=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var i=[];if(c)i=c[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(b)){e=[];if(c){e=i;c=i[i.length-1];if((i=(i=this.get("highlightedItem"))&&i.get("content"))&&i.indexOf(c)>-1&&c)e[e.length-1]=i;g.val(e.join(",")+",")}b=""}else{if(c)b=c[2]||"";e=i}this.get("enteredItems").length!=
e.length&&this.set("enteredItems",e)}g=this.get("children");var j=b&&RegExp(b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),a=this.getCls("menuitem-hit");m.each(g,function(h){var o=h.get("content");if(b)if(o.indexOf(b)>-1){h.set("visible",true);h.get("contentEl").html(o.replace(j,function(p){return"<span class='"+a+"'>"+p+"</span>"}))}else h.set("visible",false);else{h.get("contentEl").html(o);h.set("visible",true)}})},decorateInternal:function(b){this.set("el",b);
this.decorateChildren(b.one("."+this.getCls("menu-content")))},reset:function(){var b=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(b=b&&b.get("filterInput"))&&b.val("")},destructor:function(){var b=this.get("view");(b=b&&b.get("filterInput"))&&b.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:f});l.UIStore.setUIByClass("filtermenu",{priority:l.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["uibase",
"component","./base","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(m,k,l,n){var f=k.all;return l.create(n,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var d=n.prototype.getContentElement.call(this),b=this.get("filterWrap");b||this.set("filterWrap",b=f("<div class='"+this.getCls("menu-filter")+"'/>").appendTo(d));this.get("labelEl")||this.set("labelEl",f("<div class='"+this.getCls("menu-filter-label")+"'/>").appendTo(b));this.get("filterInput")||
this.set("filterInput",f("<input autocomplete='off'/>").appendTo(b));this.get("menuContent")||this.set("menuContent",f("<div class='"+this.getCls("menu-content")+"'/>").appendTo(d))},_uiSetLabel:function(d){this.get("labelEl").html(d)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(d){return d.one("."+this.getCls("menu-filter")).one("."+this.getCls("menu-filter-label"))},filterWrap:function(d){return d.one("."+this.getCls("menu-filter"))},menuContent:function(d){return d.one("."+this.getCls("menu-content"))},
filterInput:function(d){return d.one("."+this.getCls("menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});KISSY.add("menu",function(m,k,l,n,f,d,b,g,e,c,i,j){k.Render=l;k.Item=n;n.Render=f;k.SubMenu=d;d.Render=b;k.Separator=g;k.PopupMenu=c;c.Render=i;k.FilterMenu=j;return k},{requires:["menu/base","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/popupmenurender","menu/filtermenu"]});
KISSY.add("menu/menuitem",function(m,k,l,n){var f=m.all,d=k.create(l.Controller,[k.ContentBox],{_handleMouseEnter:function(b){if(d.superclass._handleMouseEnter.call(this,b))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(b){if(d.superclass._handleMouseLeave.call(this,b))return true;this.get("parent").set("highlightedItem",undefined)},_performInternal:function(){this.get("selectable")&&this.set("selected",true);this.get("checkable")&&this.set("checked",!this.get("checked"));
this.get("parent").fire("click",{target:this});return true},_uiSetChecked:function(b){this._forwardSetAttrToView("checked",b)},_uiSetSelected:function(b){this._forwardSetAttrToView("selected",b)},_uiSetHighlighted:function(b){d.superclass._uiSetHighlighted.apply(this,arguments);if(b){var g=this.get("el"),e=g.parent(function(c){return f(c).css("overflow")!="visible"},this.get("parent").get("el").parent());e&&g.scrollIntoView(e,undefined,undefined,true)}},containsElement:function(b){return this.get("view")&&
this.get("view").containsElement(b)}},{ATTRS:{focusable:{value:false},visibleMode:{value:"display"},handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},value:{},checked:{},selected:{}},HTML_PARSER:{selectable:function(b){var g=this.getCls("menuitem-selectable");return b.hasClass(g)}}});d.DefaultRender=n;l.UIStore.setUIByClass("menuitem",{priority:l.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(m,k,l,n){return l.create(n.Render,[l.ContentBox.Render],{_setSelected:function(f,d){var b=this.get("el"),g=this._completeClasses(d,"-selected");b[f?"addClass":"removeClass"](g)},_setChecked:function(f,d){var b=this.get("el"),g=this._completeClasses(d,"-checked");b[f?"addClass":"removeClass"](g)},_uiSetSelectable:function(f){this.get("el").attr("role",f?"menuitemradio":"menuitem")},_uiSetCheckable:function(f){if(f){var d=this.get("el"),b=this.getCls("menuitem-checkbox"),
g=d.one("."+b);if(!g){g=(new k("<div class='"+b+"'/>")).prependTo(d);g.unselectable()}}this.get("el").attr("role",f?"menuitemcheckbox":"menuitem")},containsElement:function(f){var d=this.get("el");return d[0]==f||d.contains(f)}},{ATTRS:{contentElCls:{valueFn:function(){return this.getCls("menuitem-content")}},elAttrs:{valueFn:function(){return{role:"menuitem",id:m.guid("ks-menuitem")}}},selected:{},checked:{}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(m,k,l,n){return l.create(n.Render,[l.ContentBox.Render],{renderUI:function(){var f=this.get("el");f.attr("role","menu").attr("aria-haspopup",true);f.attr("id")||f.attr("id",m.guid("ks-menu"))},_uiSetActiveItem:function(f){var d=this.get("el");if(f){f=f.get("el").attr("id");d.attr("aria-activedescendant",f)}else d.attr("aria-activedescendant","")},containsElement:function(f){var d=this.get("el");return d[0]===f||d.contains(f)}},{ATTRS:{activeItem:{}}})},{requires:["ua",
"uibase","component"]});
KISSY.add("menu/popupmenu",function(m,k,l,n,f){function d(c){var i=c.get("parent"),j;if(i&&i.get("menu")==c)j=i.get("parent");return j}function b(c){if((c=d(c))&&c.get(g))return c;return 0}var g="autoHideOnMouseLeave",e=k.create(n,[k.Position,k.Align],{_clearLeaveHideTimers:function(){var c,i,j;if(this.get(g)){if(c=this._leaveHideTimer){clearTimeout(c);this._leaveHideTimer=0}var a=this.get("children");for(c=0;c<a.length;c++){i=a[c];if((j=i.get("menu"))&&!m.isFunction(j)&&j.get(g))j._clearLeaveHideTimers()}}},_handleMouseLeave:function(){var c=
this,i;if(c.get(g)){c._leaveHideTimer=setTimeout(function(){c.hide();var j=c.get("parent"),a;if(j)(a=d(c))&&a.get("highlightedItem")===j&&a.set("highlightedItem",null)},c.get("autoHideDelay"));(i=b(c))&&i._handleMouseLeave()}},_handleMouseEnter:function(){if(this.get(g)){var c=b(this);c&&c._handleMouseEnter();this._clearLeaveHideTimers()}},_handleBlur:function(){e.superclass._handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"},autoHideOnMouseLeave:{},
autoHideDelay:{value:100}},DefaultRender:f});l.UIStore.setUIByClass("popupmenu",{priority:l.UIStore.PRIORITY.LEVEL2,ui:e});return e},{requires:["uibase","component","./base","./popupmenurender"]});KISSY.add("menu/popupmenurender",function(m,k,l,n){return l.create(n,[l.Position.Render,k.ie===6?l.Shim.Render:null])},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(m,k,l,n){m=k.create(l.Controller,{},{ATTRS:{focusable:{value:false},disabled:{value:true},handleMouseEvents:{value:false}},DefaultRender:n});l.UIStore.setUIByClass("menuseparator",{priority:l.UIStore.PRIORITY.LEVEL2,ui:m});return m},{requires:["uibase","component","./separatorrender"]});KISSY.add("menu/separatorrender",function(m,k,l){return k.create(l.Render,{createDom:function(){this.get("el").attr("role","separator")}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(m,k,l,n,f,d){function b(a,h){var o=a.get("parent");if(o){o.on("hide",a._onParentHide,a);h.on("click",function(p){o.fire("click",{target:p.target})});if(!o.__bindDocClickToHide){k.on(i,"click",e,a);o.__bindDocClickToHide=1;h.__bindDocClickToHide=1}h.on("afterActiveItemChange",function(p){o.set("activeItem",p.newVal)})}h.on("beforeHighlightedItemChange",a.onChildHighlight_,a)}function g(a,h){var o=a.get("menu");if(m.isFunction(o))if(h){o=o.call(a);a.__set("menu",o)}else return null;
if(o&&o.get("parent")!==a){o.__set("parent",a);b(a,o)}return o}function e(a){var h=g(this);a=a.target;var o=this.get("parent");this.get("el");if(!o.containsElement(a)){h&&h.hide();this.get("parent").set("highlightedItem",null)}}var c=k.KeyCodes,i=m.Env.host.document,j=l.create(f,[n.DecorateChild],{_onParentHide:function(){var a=g(this);a&&a.hide()},_handleMouseEnter:function(a){if(j.superclass._handleMouseEnter.call(this,a))return true;this.clearTimers();this.showTimer_=m.later(this.showMenu,this.get("menuDelay"),
false,this)},showMenu:function(){var a=g(this,1);if(a){a.set("align",m.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign")));a.render();this.get("el").attr("aria-haspopup",a.get("el").attr("id"));a.show()}},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}var a=g(this);if(a&&a._leaveHideTimer){clearTimeout(a._leaveHideTimer);a._leaveHideTimer=0}},onChildHighlight_:function(a){if(a.newVal){this.clearTimers();
this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var a=g(this);a&&a.hide()},_performInternal:function(){this.clearTimers();this.showMenu();j.superclass._performInternal.apply(this,arguments)},_handleKeydown:function(a){var h=g(this),o=h&&h.get("visible"),p=a.keyCode;if(o){if(!h._handleKeydown(a))if(p==c.LEFT){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(p==c.RIGHT){this.showMenu();if(h=g(this)){a=h.get("children");a[0]&&h.set("highlightedItem",
a[0])}}else if(a.keyCode==k.KeyCodes.ENTER)return this._performInternal(a);else return;return true},_uiSetHighlighted:function(a,h){j.superclass._uiSetHighlighted.call(this,a,h);if(!a){this.clearTimers();this.dismissTimer_=m.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(a){var h=g(this);return h&&h.containsElement(a)},decorateChildrenInternal:function(a,h,o){h.css("visibility","hidden");m.one(h[0].ownerDocument.body).prepend(h);this.__set("menu",new a({srcNode:h,
prefixCls:o}))},destructor:function(){var a=this.get("parent"),h=g(this);this.clearTimers();if(h&&h.__bindDocClickToHide){h.__bindDocClickToHide=0;k.remove(i,"click",e,this)}a&&a.detach("hide",this._onParentHide,this);h&&!this.get("externalSubMenu")&&h.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menuAlign:{},menu:{},decorateChildCls:{value:"popupmenu"}},DefaultRender:d});n.UIStore.setUIByClass("submenu",{priority:n.UIStore.PRIORITY.LEVEL2,ui:j});return j},{requires:["event",
"uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(m,k,l){var n;return n=k.create(l,{renderUI:function(){var f=this.get("el"),d=this.get("contentEl");f.attr("aria-haspopup","true");d.append(m.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(f){n.superclass._uiSetContent.call(this,f);this.get("contentEl").append(m.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
